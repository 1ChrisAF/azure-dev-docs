---
ms.custom: devx-track-js
ms.topic: include
ms.date: 02/04/2021
---


## Create an Azure Database for PostgreSQL server resource with Azure CLI

Use the following Azure CLI [az postgres server create](/cli/azure/postgres/server#az_postgres_server_create) command in the [Azure Cloud Shell](https://shell.azure.com) to create a new PostgreSQL server resource for your database. 

```azurecli
az postgres server create \
    --subscription YOUR-SUBSCRIPTION-ID-OR-NAME \
    --resource-group YOUR-RESOURCE-GROUP \
    --location eastus \
    --name YOURRESOURCENAME \
    --admin-user postgresAdmin \
    --ssl-enforcement Disabled \
    --enable-public-network Enabled 
```

This command may take a couple of minutes to complete and creates a publicly available resource in the `eastus` region. 

The response includes your server's configuration details including: 
* the autogenerated password for the admin account
* the connection string

```text
{
  "additionalProperties": {},
  "administratorLogin": "postgresAdmin",
  "byokEnforcement": "Disabled",
  "connectionString": "postgres://postgresAdmin%40diberry-postgres-2:123456789@postgres-2.postgres.database.azure.com/postgres?sslmode=require",
  "earliestRestoreDate": "2021-02-08T21:56:20.130000+00:00",
  "fullyQualifiedDomainName": "postgres-2.postgres.database.azure.com",
  "id": "/subscriptions/.../resourceGroups/my-resource-group/providers/Microsoft.DBforPostgreSQL/servers/postgres-2",
  "identity": null,
  "infrastructureEncryption": "Disabled",
  "location": "eastus",
  "masterServerId": "",
  "minimalTlsVersion": "TLSEnforcementDisabled",
  "name": "postgres-2",
  "password": "123456789",
  "privateEndpointConnections": [],
  "publicNetworkAccess": "Enabled",
  "replicaCapacity": 5,
  "replicationRole": "None",
  "resourceGroup": "my-resource-group",
  "sku": {
    "additionalProperties": {},
    "capacity": 2,
    "family": "Gen5",
    "name": "GP_Gen5_2",
    "size": null,
    "tier": "GeneralPurpose"
  },
  "sslEnforcement": "Disabled",
  "storageProfile": {
    "additionalProperties": {},
    "backupRetentionDays": 7,
    "geoRedundantBackup": "Disabled",
    "storageAutogrow": "Enabled",
    "storageMb": 51200
  },
  "tags": null,
  "type": "Microsoft.DBforPostgreSQL/servers",
  "userVisibleState": "Ready",
  "version": "9.6"
}
```

Before you can connect to the server, you need to configure your firewall rules to allow your client IP address through. 

## Add a firewall rule for your client IP address to PostgreSQL resource

By default, the firewall rules are not configured. You should add your client IP address so your client connection to the server with JavaScript is successful.

Use the following Azure CLI [az postgres server firewall-rule create](/cli/azure/postgres/server#az_postgres_server_create) command in the [Azure Cloud Shell](https://shell.azure.com) to create a new PostgreSQL server resource for your database. 


```azurecli
az postgres server firewall-rule create \
    --subscription YOUR-SUBSCRIPTION-ID-OR-NAME \
    --resource-group YOUR-RESOURCE-GROUP \
    --server YOURRESOURCENAME \
    --name AllowMyIP \
    --start-ip-address 123.123.123.123 \
    --end-ip-address 123.123.123.123
```

If you don't know your client IP address, use one of these methods:
* Use the Azure portal to view and change your firewall rules, which includes adding your detected client IP
* Run you Node.js code, the error about your firewall rules violation includes your client IP address

While you can add the full range of internet addresses as a firewall rule, 0.0.0.0-255.255.255.255, this leaves your server open to attacks. 

## Create a PostgreSQL database on the server with Azure CLI

Use the following Azure CLI [az postgres db create](/cli/azure/postgres/db#az_postgres_db_create) command in the [Azure Cloud Shell](https://shell.azure.com) to create a new PostgreSQL database on your server. 

```azurecli
az postgres db create \
    --subscription YOUR-SUBSCRIPTION-ID-OR-NAME \
    --resource-group YOUR-RESOURCE-GROUP \
    --server-name YOURRESOURCENAME \
    --name YOURDATABASENAME
```

## Get the PostgreSQL connection string with Azure CLI

Retrieve the PostgreSQL connection string for this instance with the [az postgres server show-connection-string](/cli/azure/postgres/server#az_postgres_server_show_connection_string) command:

```azurecli
az postgres server show-connection-string \
    --subscription YOUR-SUBSCRIPTION-ID-OR-NAME \
    --server-name YOURRESOURCENAME
```

This returns the connection strings for the popular languages as a JSON object. You need to replace `{database}`, `{username}`, and `{password}` with your own values before using the connection string. 

```json
{
{
  "connectionStrings": {
    "C++ (libpq)": "host=postgres-1.postgres.database.azure.com port=5432 dbname={database} user={username}postgres-1 password={password} sslmode=require",
    "ado.net": "Server=postgres-1.postgres.database.azure.com;Database={database};Port=5432;User Id={username}@postgres-1;Password={password};",
    "jdbc": "jdbc:postgresql://postgres-1.postgres.database.azure.com:5432/{database}?user={username}@postgres-1&password={password}",
    "node.js": "var client = new pg.Client('postgres://{username}@postgres-1:{password}@postgres-1.postgres.database.azure.com:5432/{database}');",
    "php": "host=postgres-1.postgres.database.azure.com port=5432 dbname={database} user={username}@postgres-1 password={password}",
    "psql_cmd": "postgresql://{username}@postgres-1:{password}@postgres-1.postgres.database.azure.com/{database}?sslmode=require",
    "python": "cnx = psycopg2.connect(database='{database}', user='{username}@postgres-1', host='postgres-1.postgres.database.azure.com', password='{password}', port='5432')",
    "ruby": "cnx = PG::Connection.new(:host => 'postgres-1.postgres.database.azure.com', :user => '{username}@postgres-1', :dbname => '{database}', :port => '5432', :password => '{password}')"
  }
}
``` 